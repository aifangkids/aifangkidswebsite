<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>填寫資料 - AIFANG KIDS</title>
    <style>
        /* 延續品牌色系 #e91e63 */
        body { font-family: 'Huninn', sans-serif; background: #fcfcfc; padding: 20px; }
        .checkout-container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .submit-btn { background: #e91e63; color: #fff; width: 100%; padding: 15px; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; }
        .order-summary { background: #f9f9f9; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="checkout-container">
        <h2>收件資訊</h2>
        <div id="summary" class="order-summary">
            </div>
        <form id="orderForm">
            <div class="form-group">
                <label>姓名 *</label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <label>電話 *</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label>取貨方式 *</label>
                <select id="shippingMethod">
                    <option value="7-11">7-11 店到店</option>
                    <option value="FamilyMart">全家 店到店</option>
                    <option value="Home">宅配到府</option>
                </select>
            </div>
            <div class="form-group">
                <label>收件地址/店名 *</label>
                <textarea id="address" rows="3" required></textarea>
            </div>
            <button type="submit" class="submit-btn">確認送出訂單</button>
        </form>
    </div>

    <script>
        // 1. 載入購物車資訊顯示總額
        const cart = JSON.parse(localStorage.getItem('shoppingCart') || "[]");
        const total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0) + 60;
        document.getElementById('summary').innerHTML = `您總共購買了 ${cart.length} 項商品，總計 TWD ${total} (含運費)`;

        // 2. 處理表單送出
document.getElementById('orderForm').onsubmit = async (e) => {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button');
    submitBtn.disabled = true;
    submitBtn.innerText = "訂單送出中...";

    const orderData = {
        customer: {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            email: "aifangkids@gmail.com", // 這裡可改成 input 欄位
            address: document.getElementById('address').value,
            method: document.getElementById('shippingMethod').value
        },
        items: cart,
        totalPrice: total
    };

    try {
        const response = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify(orderData)
        });
        const result = await response.json();

        if (result.result === 'success') {
            alert('訂單已成功送出！感謝您的購買。');
            localStorage.removeItem('shoppingCart'); // 清空購物車
            window.location.href = 'index.html'; // 回首頁
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        alert('送出失敗，請檢查網路或聯繫客服：' + error);
        submitBtn.disabled = false;
        submitBtn.innerText = "確認送出訂單";
    }
};
    </script>
</body>
</html>