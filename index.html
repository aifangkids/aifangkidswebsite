<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiFangKids 選品 - All</title>
    
    <style>
        /* ------------------------------------
           通用重置與字體設定 (粉圓體)
        ------------------------------------ */
        @import url('https://fonts.googleapis.com/css2?family=Huninn&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Huninn', 'Noto Sans TC', Arial, sans-serif; 
            color: #333;
            background-color: #fff;
            line-height: 1.5;
            font-size: 14px; 
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }

        ul {
            list-style: none;
        }
        
        button {
            border: none;
            background: none;
            cursor: pointer;
            padding: 0;
            color: inherit;
            font-family: inherit;
        }

        .wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ------------------------------------
           導航列 (Navbar)
        ------------------------------------ */
        #navbar {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo a {
            font-size: 24px;
            font-weight: bold;
            color: #e91e63; /* 亮粉紅色系 */
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            text-transform: uppercase;
            font-size: 14px;
            padding: 5px 0;
            position: relative;
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 100%;
            height: 2px;
            background-color: #e91e63;
        }

        .nav-icons {
            display: flex;
            gap: 15px;
            font-size: 18px;
        }

        /* ------------------------------------
           主內容區 (Main Content)
        ------------------------------------ */
        #main-content {
            padding: 40px 0;
        }

        .product-list-container {
            margin-top: 30px;
        }

        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .product-item {
            text-align: center;
            padding: 10px;
            border: 1px solid #f0f0f0;
            transition: box-shadow 0.3s;
        }

        .product-item:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .product-image img {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
        }

        .product-name {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .price-box {
            margin-top: 5px;
            font-size: 14px;
        }

        .original-price {
            color: #999;
            text-decoration: line-through;
            margin-right: 10px;
        }

        .discount-price {
            color: #e91e63;
            font-weight: bold;
            font-size: 16px;
        }
        
        .color-swatches {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 5px;
            height: 15px; /* 確保高度一致 */
        }
        
        .swatch {
            display: block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 1px solid #ccc;
        }

        /* ------------------------------------
           Footer
        ------------------------------------ */
        #footer {
            background-color: #333;
            color: #fff;
            padding: 30px 0;
            margin-top: 50px;
        }

        .footer-cols {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .footer-cols h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .copyright {
            border-top: 1px solid #555;
            padding-top: 15px;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    
    <header id="navbar">
        <div class="wrapper nav-content">
            <div class="logo">
                <a href="index.html">AIFANG KIDS</a>
            </div>
            <nav class="nav-links">
                <a href="index.html" class="active">ALL</a>
                <a href="#">上衣</a>
                <a href="#">下著</a>
                <a href="#">外套</a>
            </nav>
            <div class="nav-icons">
                <a href="#"><i class="fas fa-search"></i></a>
                <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
                <a href="#"><i class="fas fa-user"></i></a>
            </div>
        </div>
    </header>

    <div id="main-content">
        <div class="wrapper">
            <h2>所有產品</h2>
            
            <div class="product-list-container">
                <ul class="product-list" id="product-list">
                    <li>載入產品中...</li> 
                </ul>
            </div>
            
        </div>
    </div>

    <footer id="footer">
        <div class="wrapper footer-cols">
            <div class="customer-center">
                <h3>CUSTOMER CENTER</h3>
                <p>MAIL: aifangkids@gmail.com</p>
                <p>服務時間: AM 10:00 - PM 21:00</p>
                <p>週末與國定假日休息，訂單及出貨將於工作日為您處理</p>
            </div>
            <div class="company-info">
                <h3>COMPANY INFO</h3>
                <p>公司名稱: 璦坊童裝</p>
                <p>統一編號: 95294390</p>
            </div>
        </div>
        <div class="copyright wrapper">
            <p>Copyright © **Aifang Kids Studio** All rights reserved.</p>
        </div>
    </footer>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <script>
        // =========================================================
        // 這是您部署後的 Google Apps Script URL
        // =========================================================
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxj1KQbiB3Q4aJAIJDJ_LcIbddkkrBNeCS_J1Wo44JbGZW6KpjmhmHxemURciWA8p6QyA/exec'; 

        // 取得產品清單容器
        const productListEl = document.getElementById('product-list');

        /**
         * 根據產品資料物件，生成單一產品的 HTML 卡片。
         * @param {Object} product - 單一產品資料物件。
         * @returns {string} 產品卡片的 HTML 字符串。
         */
        function createProductCard(product) {
            // 確保 price_original 和 price_sale 是數字
            const originalPrice = parseFloat(product.price_original) || 0;
            const salePrice = parseFloat(product.price_sale) || 0;
            
            // 處理圖片 URL，避免出現 'undefined'
            const imageUrl = product.main_image || '/images/placeholder.jpg';
            const productName = product.name || '無名稱產品';

            // --- 顏色顯示邏輯 (解析 sizes 欄位) ---
            // 試算表 sizes 範例格式: S-黑白格紋-3； M-蝴蝶結-5
            let colorNames = [];
            if (product.sizes) {
                const parts = String(product.sizes).split('；');
                colorNames = parts.map(part => {
                    // 尋找第一個 '-' 和第二個 '-' 之間的內容，即顏色/花紋名稱
                    const match = part.trim().match(/-([^-\s]+)-/); 
                    return match ? match[1] : ''; 
                }).filter(name => name.length > 0)
                  .slice(0, 3); // 最多只顯示 3 個顏色/花紋
            }
            
            // 簡易的顏色代碼對應表
            const colorMap = {
                '黑白格紋': '#4A4A4A',
                '蝴蝶結': '#FFB6C1', 
                '白': '#E0E0E0',
                '黑': '#333333',
                '米': '#F5F5DC',
                '粉': '#FFC0CB',
                '灰': '#CCCCCC'
                // 請根據您的產品顏色增加更多對應
            };
            
            const colorSwatchesHtml = colorNames.map(colorName => {
                const colorCode = colorMap[colorName] || '#CCCCCC'; 
                // 將顏色名稱儲存在 data-name 中，滑鼠懸停時可顯示
                return `<span class="swatch" title="${colorName}" style="background-color: ${colorCode};"></span>`;
            }).join('');

            return `
                <li class="product-item">
                    <a href="detail.html?id=${product.id}" class="product-link">
                        <div class="product-image">
                            <img src="${imageUrl}" alt="${productName}">
                        </div>
                    </a>
                    <div class="product-info">
                        <div class="color-swatches">
                            ${colorSwatchesHtml}
                        </div>
                    </div>
                    <a href="detail.html?id=${product.id}" class="product-name">${productName}</a>
                    <div class="price-box">
                        <span class="original-price">${originalPrice.toFixed(0)} TWD</span>
                        <span class="discount-price">${salePrice.toFixed(0)} TWD</span>
                    </div>
                </li>
            `;
        }

        /**
         * 抓取 Apps Script 的資料並渲染到網頁上。
         */
        async function fetchAndRenderProducts() {
            // 顯示載入狀態
            if (productListEl) {
                productListEl.innerHTML = '<li style="text-align: center; width: 100%;">正在從 Google 試算表載入產品資料...</li>';
            }

            try {
                const response = await fetch(GAS_URL);
                const products = await response.json(); 

                if (productListEl) {
                    if (products && Array.isArray(products) && products.length > 0) {
                        // 將所有產品卡片 HTML 組合起來
                        const htmlContent = products.map(createProductCard).join('');
                        productListEl.innerHTML = htmlContent;
                    } else {
                        productListEl.innerHTML = '<li style="text-align: center; width: 100%;">目前沒有任何產品。</li>';
                    }
                }

            } catch (error) {
                console.error('讀取產品資料失敗:', error);
                if (productListEl) {
                    productListEl.innerHTML = '<li style="text-align: center; width: 100%; color: red;">載入資料失敗，請檢查網路或 Apps Script URL。</li>';
                }
            }
        }

        // 頁面載入時執行一次
        window.onload = () => {
            fetchAndRenderProducts();
        };
    </script>
</body>
</html>