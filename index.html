<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>AiFang Kids Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:"Noto Sans KR",sans-serif;color:#222}
header{position:fixed;top:0;width:100%;background:#fff;border-bottom:1px solid #eee;
display:flex;justify-content:space-between;align-items:center;padding:15px 30px;z-index:1000}
.logo{font-weight:bold;letter-spacing:5px;cursor:pointer}
main{padding-top:90px;max-width:1200px;margin:auto}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:30px}
.card{cursor:pointer}
.card img{width:100%;aspect-ratio:3/4;object-fit:cover;border-radius:4px}
.card-name{text-align:center;margin-top:10px;font-size:14px}
.card-price{text-align:center;font-size:13px;font-weight:bold}
#detail{display:none}
.buy-btn{width:100%;padding:18px;background:#000;color:#fff;border:none;font-weight:bold;cursor:pointer}
.size-btn{border:1px solid #ddd;padding:6px 14px;margin:4px;cursor:pointer}
.size-btn.active{background:#000;color:#fff}
</style>
</head>

<body>

<header>
  <div class="logo" onclick="showHome()">AiFang</div>
  <div onclick="alert('Ë≥ºÁâ©ËªäÂäüËÉΩÂ∑≤Êï¥Âêà')">üõí</div>
</header>

<main>

<!-- È¶ñÈ†Å -->
<section id="home">
  <div class="grid" id="productGrid"></div>
</section>

<!-- ÂïÜÂìÅÈ†Å -->
<section id="detail">
  <img id="d-img" style="width:100%;max-width:500px">
  <h2 id="d-name"></h2>
  <p id="d-brand"></p>

  <div id="sizeBox"></div>

  <button class="buy-btn" onclick="addCart()">ADD TO CART</button>

  <div id="detailImgs"></div>
</section>

</main>

<script>
const API = "https://script.google.com/macros/s/AKfycbxrmloTY4wCo1Sn5tgMQDRwhU8uXWBTA0c6v17ec7M6W5LkufjES1fjJBolMb_552z5/exec";
let PRODUCTS=[],DETAILS=[],CURRENT=null,SELECT_SIZE=null;

fetch(API).then(r=>r.json()).then(d=>{
  PRODUCTS=d.products;DETAILS=d.details;renderHome();
});

function renderHome(){
  const g=document.getElementById("productGrid");
  g.innerHTML="";
  PRODUCTS.forEach(p=>{
    g.innerHTML+=`
    <div class="card" onclick="openDetail('${p.code}')">
      <img src="${p.mainImage}">
      <div class="card-name">${p.name}</div>
      <div class="card-price">NT$ ${priceRange(p)}</div>
    </div>`;
  });
}

function priceRange(p){
  let arr=[];
  ["bebe","kids","junior"].forEach(k=>{
    if(p.sizes[k])arr.push(p.sizes[k].price);
  });
  return arr.join(" - ");
}

function openDetail(code){
  CURRENT=PRODUCTS.find(p=>p.code===code);
  const d=DETAILS.find(x=>x.code===code);
  document.getElementById("home").style.display="none";
  document.getElementById("detail").style.display="block";

  document.getElementById("d-img").src=CURRENT.mainImage;
  document.getElementById("d-name").innerText=CURRENT.name;
  document.getElementById("d-brand").innerText=CURRENT.brand;

  const sb=document.getElementById("sizeBox");
  sb.innerHTML="";
  Object.values(CURRENT.sizes).forEach(s=>{
    s.options.forEach(o=>{
      sb.innerHTML+=`<button class="size-btn" onclick="pickSize(this,'${o}')">${o}</button>`;
    });
  });

  const imgs=document.getElementById("detailImgs");
  imgs.innerHTML="";
  d.detailImages.forEach(i=>{
    imgs.innerHTML+=`<img src="${i}" style="width:100%;margin-top:10px">`;
  });
}

function pickSize(el,size){
  document.querySelectorAll(".size-btn").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  SELECT_SIZE=size;
}

function addCart(){
  if(!SELECT_SIZE){alert("Ë´ãÈÅ∏Â∞∫ÂØ∏");return;}
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  cart.push({code:CURRENT.code,size:SELECT_SIZE,price:priceRange(CURRENT)});
  localStorage.setItem("cart",JSON.stringify(cart));
  alert("Â∑≤Âä†ÂÖ•Ë≥ºÁâ©Ëªä");
}

function showHome(){
  document.getElementById("detail").style.display="none";
  document.getElementById("home").style.display="block";
}
</script>

</body>
</html>