<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>AiFang Kids Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:"Noto Sans KR",sans-serif;color:#222}
header{position:fixed;top:0;width:100%;background:#fff;border-bottom:1px solid #eee;
display:flex;justify-content:space-between;align-items:center;padding:15px 30px;z-index:1000}
.logo{font-weight:bold;letter-spacing:5px;cursor:pointer}
.cart-btn{cursor:pointer;position:relative}
.cart-count{position:absolute;top:-6px;right:-10px;background:#000;color:#fff;
font-size:10px;padding:2px 6px;border-radius:10px}

main{padding-top:90px;max-width:1200px;margin:auto}

/* ÂïÜÂìÅÂç° */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:30px}
.card{cursor:pointer}
.card img{width:100%;aspect-ratio:3/4;object-fit:cover;border-radius:4px}
.card-name{text-align:center;margin-top:10px;font-size:14px}
.card-price{text-align:center;font-size:13px;font-weight:bold}

/* ÂÅ¥Ê¨ÑË≥ºÁâ©Ëªä */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;z-index:1500}
.cart-side{position:fixed;top:0;right:-420px;width:420px;height:100vh;background:#fff;
z-index:2000;transition:.4s;display:flex;flex-direction:column}
.cart-side.active{right:0}
.cart-header{padding:25px;border-bottom:1px solid #eee;font-weight:bold;
display:flex;justify-content:space-between}
.cart-body{flex:1;overflow:auto;padding:20px}
.cart-item{display:flex;gap:15px;margin-bottom:20px}
.cart-item img{width:70px;aspect-ratio:3/4;object-fit:cover}
.cart-item-name{font-size:13px;font-weight:bold}
.cart-item-spec{font-size:11px;color:#777}
.cart-item-price{font-size:13px;font-weight:bold;margin-top:5px}
.cart-footer{padding:20px;border-top:1px solid #eee;background:#fafafa}
.row{display:flex;justify-content:space-between;margin-bottom:8px}
.checkout-btn{width:100%;padding:16px;background:#000;color:#fff;border:none;
font-weight:bold;cursor:pointer;margin-top:10px}

/* ÁµêÂ∏≥È†Å */
#checkout{display:none;max-width:800px;margin:auto}
.form-group{margin-bottom:15px}
label{font-size:12px;font-weight:bold}
input,select{width:100%;padding:10px;border:1px solid #ddd}

.done{padding:60px;text-align:center}
</style>
</head>

<body>

<header>
  <div class="logo" onclick="showHome()">AiFang</div>
  <div class="cart-btn" onclick="openCart()">üõí
    <span class="cart-count" id="cartCount">0</span>
  </div>
</header>

<div class="overlay" id="overlay" onclick="closeCart()"></div>

<!-- ÂÅ¥Ê¨ÑË≥ºÁâ©Ëªä -->
<div class="cart-side" id="cartSide">
  <div class="cart-header">
    SHOPPING BAG
    <span style="cursor:pointer" onclick="closeCart()">‚úï</span>
  </div>
  <div class="cart-body" id="cartItems"></div>
  <div class="cart-footer">
    <div class="row"><span>Â∞èË®à</span><span id="cartTotal">NT$0</span></div>
    <button class="checkout-btn" onclick="goCheckout()">CHECK OUT</button>
  </div>
</div>

<main>

<section id="home">
  <div class="grid" id="productGrid"></div>
</section>

<section id="checkout">
  <h2>CHECKOUT</h2>

  <div id="checkoutList"></div>

  <div class="form-group">
    <label>‰ªòÊ¨æÊñπÂºè</label>
    <select id="payment">
      <option value="ËΩâÂ∏≥ÂåØÊ¨æ">ËΩâÂ∏≥ÂåØÊ¨æ</option>
      <option value="Ë≤®Âà∞‰ªòÊ¨æ">Ë≤®Âà∞‰ªòÊ¨æ</option>
    </select>
  </div>

  <div class="form-group">
    <label>Áâ©ÊµÅÊñπÂºè</label>
    <select id="shipping">
      <option value="ÂÆÖÈÖç">ÂÆÖÈÖç</option>
      <option value="7-11">7-11</option>
    </select>
  </div>

  <div class="form-group">
    <label>Êî∂‰ª∂‰∫∫</label>
    <input id="consignee">
  </div>

  <div class="form-group">
    <label>7-11 Â∫óËôüÔºàÈÅ∏Â°´Ôºâ</label>
    <input id="store">
  </div>

  <button class="checkout-btn" onclick="submitOrder()">CONFIRM ORDER</button>
</section>

<section id="done" style="display:none">
  <div class="done">
    <h2>Ë®ÇÂñÆÂÆåÊàê</h2>
    <p id="orderMsg"></p>
  </div>
</section>

</main>

<script>
const API="https://script.google.com/macros/s/AKfycbxrmloTY4wCo1Sn5tgMQDRwhU8uXWBTA0c6v17ec7M6W5LkufjES1fjJBolMb_552z5/exec";
let PRODUCTS=[];

fetch(API).then(r=>r.json()).then(d=>{
  PRODUCTS=d.products;renderHome();updateCartUI();
});

function renderHome(){
  const g=document.getElementById("productGrid");
  g.innerHTML="";
  PRODUCTS.forEach(p=>{
    g.innerHTML+=`
    <div class="card" onclick="addDemo('${p.code}')">
      <img src="${p.mainImage}">
      <div class="card-name">${p.name}</div>
      <div class="card-price">NT$ ${price(p)}</div>
    </div>`;
  });
}

function price(p){
  let arr=[];
  Object.values(p.sizes).forEach(s=>arr.push(s.price));
  return arr.join("-");
}

/* Demo Âä†ÂÖ•Ë≥ºÁâ©Ëªä */
function addDemo(code){
  const p=PRODUCTS.find(x=>x.code===code);
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  cart.push({code:p.code,name:p.name,img:p.mainImage,price:price(p),qty:1});
  localStorage.setItem("cart",JSON.stringify(cart));
  updateCartUI();openCart();
}

/* Ë≥ºÁâ©Ëªä */
function updateCartUI(){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  document.getElementById("cartCount").innerText=cart.length;
  const box=document.getElementById("cartItems");
  let total=0;box.innerHTML="";
  cart.forEach((c,i)=>{
    total+=parseInt(c.price);
    box.innerHTML+=`
    <div class="cart-item">
      <img src="${c.img}">
      <div>
        <div class="cart-item-name">${c.name}</div>
        <div class="cart-item-price">NT$ ${c.price}</div>
      </div>
    </div>`;
  });
  document.getElementById("cartTotal").innerText="NT$ "+total;
}

function openCart(){document.getElementById("cartSide").classList.add("active");document.getElementById("overlay").style.display="block";}
function closeCart(){document.getElementById("cartSide").classList.remove("active");document.getElementById("overlay").style.display="none";}

function goCheckout(){
  closeCart();
  document.getElementById("home").style.display="none";
  document.getElementById("checkout").style.display="block";
  renderCheckout();
}

function renderCheckout(){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  const box=document.getElementById("checkoutList");
  box.innerHTML="";
  cart.forEach(c=>{
    box.innerHTML+=`<p>${c.name} NT$ ${c.price}</p>`;
  });
}

function submitOrder(){
  const cart=JSON.parse(localStorage.getItem("cart")||"[]");
  const total=cart.reduce((a,b)=>a+parseInt(b.price),0);

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      paymentTerms:payment.value,
      shippingMethod:shipping.value,
      consignee:consignee.value,
      totalPrice:total,
      storeNumber:store.value
    })
  }).then(r=>r.json()).then(res=>{
    localStorage.removeItem("cart");
    document.getElementById("checkout").style.display="none";
    document.getElementById("done").style.display="block";
    document.getElementById("orderMsg").innerText="Ë®ÇÂñÆÁ∑®ËôüÔºö"+res.orderID;
  });
}

function showHome(){
  document.getElementById("checkout").style.display="none";
  document.getElementById("done").style.display="none";
  document.getElementById("home").style.display="block";
}
</script>

</body>
</html>
